{%- load_yaml as base_defaults %}

Debian:
  pkgs:
  - openjdk-8-jre
  - logstash
  service: logstash
  version: '5'
  port: 5601
  server_name: logstash
  server_host: "0.0.0.0"
  elasticsearch_hosts: "http://localhost:9200"
  file_collection_logs:
  - /var/log/syslog
  - /var/log/auth.log
{% for server in salt['mine.get']('roles:nginx', 'network.ip_addrs', tgt_type='grain') | dictsort() %}
  - /var/log/nginx/access.log
  - /var/log/nginx/error.log
{% endfor %}
  applied_filters:
  - nginx
  - syslog

RedHat:
  pkgs:
  - java-1.8.0-openjdk
  - logstash
  service: logstash
  version: '5'
  port: 5601
  server_name: logstash
  server_host: "0.0.0.0"
  elasticsearch_hosts: "http://localhost:9200"
  file_collection_logs:
  - /var/log/syslog
  - /var/log/auth.log
{% for server in salt['mine.get']('roles:nginx', 'network.ip_addrs', tgt_type='grain') | dictsort() %}
  - /var/log/nginx/access.log
  - /var/log/nginx/error.log
{% endfor %}
  applied_filters:
  - nginx
  - syslog

default:
  version: 5

{%- endload %}

{%- set logstash = salt['grains.filter_by'](base_defaults, merge=salt['pillar.get']('logstash:server'), base='default') %}

