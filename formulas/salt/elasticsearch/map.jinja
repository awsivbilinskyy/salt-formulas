{%- load_yaml as base_defaults %}
Debian:
  pkgs:
  - default-jre-headless
  - elasticsearch
  curator_pkgs:
  - elasticsearch-curator
  - cron
  service: elasticsearch
  version: '1.4.4'
  elasticsearch_user: elasticsearch
  elasticsearch_group: elasticsearch
  directorylist:
  - /usr/share/elasticsearch
  - /var/log/elasticsearch
  - /var/lib/elasticsearch
  - /etc/elasticsearch
  filelist:
  - /etc/default/elasticsearch

RedHat:
  pkgs:
  - java-11-openjdk
  - java-11-openjdk-devel
  - elasticsearch
  curator_pkgs:
  - elasticsearch-curator
  service: elasticsearch
  version: '1.4.4'
  elasticsearch_user: elasticsearch
  elasticsearch_group: elasticsearch
  directorylist:
  - /usr/share/elasticsearch
  - /var/log/elasticsearch
  - /var/lib/elasticsearch
  - /etc/elasticsearch
  filelist:
  - /etc/default/elasticsearch

default:
  version: 5

{%- endload %}

{%- set elasticsearch = salt['grains.filter_by'](base_defaults, merge=salt['pillar.get']('elasticsearch'), base='default') %}

{%- load_yaml as client_defaults %}
Debian:
  pkgs:
  - default-jre-headless
  - python-elasticsearch
  server:
    host: 127.0.0.1
    port: 9200
    binary_port: 9300
RedHat:
  pkgs:
  - java-11-openjdk
  - python-elasticsearch
  server:
    host: 127.0.0.1
    port: 9200
    binary_port: 9300
{%- endload %}

{%- set client = salt['grains.filter_by'](client_defaults, merge=salt['pillar.get']('elasticsearch:client')) %}

{% set monitoring = salt['grains.filter_by']({
    'default': {
        'service_failed_warning_threshold_percent': 0.3,
        'service_failed_critical_threshold_percent': 0.6,
        'service_disk_space_watermark_minor_threshold_percent': 0.6,
        'service_disk_space_watermark_major_threshold_percent': 0.75,
    },
}, grain='os_family', merge=salt['pillar.get']('elasticsearch:monitoring')) %}
